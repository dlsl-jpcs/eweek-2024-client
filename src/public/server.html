<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Fest 2024 Server</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js">
    </script>

    <script>



        function register() {
            var student_id = document.getElementById("student_id").value;

            const url = window.location.href + "/api/v1/player/register";

            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/api/v1/player/register", true);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {


                    var json = JSON.parse(xhr.responseText);
                    console.log(json);
                    if (json.status === "verified") {
                        const code = json.code;
                        setState({
                            state: "verified",
                            code: code
                        });
                        return;
                    }

                    if (json.status === "user_already_exists") {
                        const code = json.code;
                        setState({
                            state: "user_already_exists",
                            code: code
                        });
                        return;
                    }


                    if (json.status === "invalid") {
                        setState({
                            state: invalid
                        })

                        return;
                    }

                }
            };
            xhr.send(JSON.stringify({
                student_id: student_id
            }));
        }
    </script>



    <script>

        function setState(state) {
            if (state.state === "verified" || state.state === "user_already_exists") {
                document.getElementById("student_id").value = "";
                new QRCode(document.getElementById("qrcode"), state.code);
                return;
            }
        }
    </script>
</head>

<body>

    <div id="qrcode"></div>

    <h1>Register</h1>

    <textarea id="student_id" placeholder="Student ID"></textarea>


    <button onclick="register()">Register</button>

</body>

</html>